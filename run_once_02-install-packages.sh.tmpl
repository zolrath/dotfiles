#!/bin/sh

. $HOME/.local/share/chezmoi/helpers

echo ''

info 'ðŸ“¦ Installing packages'

{{ if eq .chezmoi.os "linux" -}}

sudo apt install -y ripgrep exa fzf git-delta

if ! [ -x "$(command -v zoxide)" ]; then
    info 'ðŸ“¦ Installing zoxide'
    curl -sS https://raw.githubusercontent.com/ajeetdsouza/zoxide/main/install.sh | bash
    success 'zoxide'
else
    skip 'zoxide'
fi

if ! [ -x "$(command -v lazygit)" ]; then
    info 'ðŸ“¦ Installing lazygit'
    LAZYGIT_VERSION=$(curl -s "https://api.github.com/repos/jesseduffield/lazygit/releases/latest" | grep '"tag_name":' |  sed -E 's/.*"v*([^"]+)".*/\1/')
    curl -Lo lazygit.tar.gz "https://github.com/jesseduffield/lazygit/releases/latest/download/lazygit_${LAZYGIT_VERSION}_Linux_x86_64.tar.gz"
    sudo tar xf lazygit.tar.gz -C $HOME/.local/bin/ lazygit
    rm lazygit.tar.gz
    success 'lazygit'
else
    skip 'lazygit'
fi

if ! [ -x "$(command -v delta)" ]; then
    info 'ðŸ“¦ Installing delta'
    DELTA_VERSION=$(curl -s "https://api.github.com/repos/dandavison/delta/releases/latest" | grep '"tag_name":' |  sed -E 's/.*"v*([^"]+)".*/\1/')
    curl -Lo delta.deb "https://github.com/dandavison/delta/releases/latest/download/git-delta_${DELTA_VERSION}_amd64.deb"
    sudo dpkg -i delta.deb
    rm delta.deb
    success 'delta'
else
    skip 'delta'
fi

if ! [ -x "$(command -v lazydocker)" ]; then

    info 'ðŸ“¦ Installing lazydocker'
    curl https://raw.githubusercontent.com/jesseduffield/lazydocker/master/scripts/install_update_linux.sh | bash
    success 'lazydocker'
else
    skip 'lazydocker'
fi

if ! [ -x "$(command -v glow)" ]; then
    info 'ðŸ“¦ Installing glow'
    sudo mkdir -p /etc/apt/keyrings
    curl -fsSL https://repo.charm.sh/apt/gpg.key | sudo gpg --dearmor -o /etc/apt/keyrings/charm.gpg
    echo "deb [signed-by=/etc/apt/keyrings/charm.gpg] https://repo.charm.sh/apt/ * *" | sudo tee /etc/apt/sources.list.d/charm.list
    sudo apt update && sudo apt install glow
    success 'glow'
else
    skip 'glow'
fi

{{ else if eq .chezmoi.os "darwin" -}}

brew install ripgrep exa fzf zoxide git-delta gnu-sed glow
brew install jesseduffield/lazygit/lazygit
brew install jesseduffield/lazydocker/lazydocker

{{ end -}}

success 'packages'

echo ''
